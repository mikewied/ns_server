<div
   mn-spinner="!serversCtl.nodes || !adminCtl.tasks || !serversCtl.getGroupsByHostname || serversCtl.showSpinner"
   min-height="91px">
  <table mn-sortable-table="hostname" class="table-stroked">
    <tbody>
      <tr>
        <th class="text-center" mn-sortable-title="hostname" colspan="2">Server Node Name</th>
        <th
           class="text-center"
           mn-sortable-title="group"
           style="{%= serversCtl.mnPoolDefault.value.isGroupsAvailable && rbac.cluster.server_groups.read ? 'width: auto;' : 'width: 0px;' %}">
          {{ poolDefault.isGroupsAvailable && rbac.cluster.server_groups.read ? "Group" : " " }}
        </th>
        <th class="text-center" mn-sortable-title="services">Services</th>
        <th class="text-center">RAM Usage</th>
        <th class="text-center">Swap Usage</th>
        <th class="text-center">CPU Usage</th>
        <th class="text-center">Disk Available / Used</th>
        <th class="text-center">Items Active / Replica</th>
        <th></th>
      </tr>
    </tbody>
    <tbody
       ng-repeat="node in serversCtl.nodes[serversListCtl.stateParamsNodeType] | orderBy:serversListCtl.sortableTableProperties.orderBy:serversListCtl.sortableTableProperties.invert track by node.otpNode">
      <tr
         ng-if="serversListCtl.isNodeInactiveFaied(node) && !serversListCtl.isNodeUnhealthy(node) && rbac.cluster.nodes.write">
        <td colspan="10">
          <div class="row">
            <span>
              This server is now reachable. Do you want to add it back to the cluster on the next rebalance?
            </span>

            <span>
              <span ng-click="serversListCtl.reAddNode('full', node.otpNode)">
                <button ng-show="serversListCtl.isKVNode(node)">Add Back: Full Recovery</button>
                <button ng-show="!serversListCtl.isKVNode(node)">Add Back</button>
              </span>
              <span
                 ng-show="serversListCtl.isKVNode(node) && poolDefault.compat.atLeast30"
                 ng-click="serversListCtl.reAddNode('delta', node.otpNode)">
                <button>Add Back: Delta Recovery</button>
              </span>
            </span>
          </div>
        </td>
      </tr>

      <tr
         class="has-hover"
         ng-click="!serversListCtl.isNodeUnhealthy(node) && rbac.cluster.nodes.read && serversCtl.toggleDetails(node.hostname)"
         ng-class="{
                 'grayblue-5': serversCtl.isDetailsOpened(node.hostname),
                 'no-stroke': serversCtl.isDetailsOpened(node.hostname)
                 }">
        <td
           class="node-status"
           ng-class="['dynamic_' + node.status, 'dynamic_' + node.clusterMembership]">
        </td>
        <td class="ellipsis text-nowrap">
          <a
             ng-if="!serversListCtl.isNodeUnhealthy(node) && rbac.cluster.nodes.read"
             title="Show Server Node info">
            <span
               class="expander"
               ng-class="{closed: !serversCtl.isDetailsOpened(node.hostname)}">
            </span>
          </a>
          <span ng-if="serversListCtl.isNodeInactiveFaied(node) && !serversListCtl.isNodeUnhealthy(node) && rbac.cluster.stats.read">
            {{node.hostname | mnStripPortHTML:serversCtl.nodes.allNodes}}
          </span>
          <span ng-if="serversListCtl.isNodeUnhealthy(node) || !rbac.cluster.stats.read">
            {{node.hostname}}
          </span>
          <a
             ng-if="!serversListCtl.isNodeInactiveFaied(node) && !serversListCtl.isNodeUnhealthy(node) && rbac.cluster.stats.read"
             title="{{'View Analytics for ' + node.hostname}}"
             class="link-heavy"
             ui-sref="app.admin.analytics.list.graph({statsHostname: node.hostname})">
            {{node.hostname | mnStripPortHTML:serversCtl.nodes.allNodes}}
          </a>
        </td>
        <td class="text-center">
          <div
             ng-show="serversCtl.mnPoolDefault.value.isGroupsAvailable"
             class="ellipsis"
             ng-show="rbac.cluster.server_groups.read"
             title="{{serversCtl.getGroupsByHostname[node.hostname].name}}">
            {{serversCtl.getGroupsByHostname[node.hostname].name}}
          </div>
        </td>
        <td class="text-center">
          <div ng-repeat="service in node.services | mnFormatServicesArray | orderBy">
            {{service}}
          </div>
        </td>

        <td
           class="text-center"
           mn-vertical-bar=""
           conf="serversListCtl.getRamUsageConf(node)">
        </td>
        <td
           class="text-center"
           mn-vertical-bar=""
           conf="serversListCtl.getSwapUsageConf(node)">
        </td>
        <td
           class="text-center"
           mn-vertical-bar=""
           conf="serversListCtl.getCpuUsageConf(node)">
        </td>
        <td class="text-center">
          <span ng-if="!serversListCtl.isDataDiskUsageAvailable(node)">
            N/A
          </span>
          <span ng-if="serversListCtl.isDataDiskUsageAvailable(node)">
            {{serversListCtl.couchDataSize(node) | mnFormatQuantity}} / {{serversListCtl.couchDiskUsage(node) | mnFormatQuantity}}
          </span>
        </td>

        <td class="text-center">
          {{node.interestingStats.curr_items || 0 | mnFormatQuantity:1000:' ' }} /
          {{node.interestingStats.vb_replica_curr_items || 0 | mnFormatQuantity:1000:' ' }}
        </td>
        <td ng-if="adminCtl.tasks.inRebalance && adminCtl.tasks.tasksRebalance.status === 'running' && rbac.cluster.tasks.read">
          <span>
            {{serversListCtl.getRebalanceProgress(node) | mnTruncateTo3Digits}} % Complete
          </span>
          <span><span ng-style="{width: (serversListCtl.getRebalanceProgress(node) | mnTruncateTo3Digits) + '%'}"></span></span>
        </td>
        <td  ng-if="!adminCtl.tasks.inRebalance && serversListCtl.isNodeInactiveAdded(node) && node.recoveryType === 'none' && rbac.cluster.tasks.read">
          <span class="warning">Pending Add</span>
          <a
             ng-show="rbac.cluster.nodes.write"
             ng-class="{dynamic_disabled: adminCtl.tasks.inRecoveryMode}"
             ng-click="!adminCtl.tasks.inRecoveryMode && serversListCtl.ejectServer(node)">Cancel</a>
        </td>
        <td
           ng-if="!adminCtl.tasks.inRebalance && serversListCtl.isNodeInactiveAdded(node) && node.recoveryType !== 'none' && rbac.cluster.tasks.read"
           class="text-center">
          <span class="warning">Pending {{node.recoveryType}} recovery</span>
          &nbsp;
          <a
             ng-show="rbac.cluster.nodes.write"
             class="link-heavy"
             ng-class="{dynamic_disabled: adminCtl.tasks.inRecoveryMode}"
             ng-click="!adminCtl.tasks.inRecoveryMode && serversListCtl.cancelFailOverNode(node.otpNode)">Cancel</a>
        </td>
        <td
           ng-show="rbac.cluster.tasks.read"
           ng-if="!adminCtl.tasks.inRebalance && !serversListCtl.isNodeInactiveAdded(node) && node.pendingEject;">
          <span class="warning">Pending Removal</span>
          <a
             ng-show="rbac.cluster.nodes.write"
             ng-class="{dynamic_disabled: adminCtl.tasks.inRecoveryMode}"
             ng-click="!adminCtl.tasks.inRecoveryMode && serversListCtl.cancelEjectServer(node)"><span>Cancel</span></a>
        </td>
        <td
           ng-if="!adminCtl.tasks.inRebalance && !serversListCtl.isNodeInactiveAdded(node) && !node.pendingEject && rbac.cluster.tasks.read"
           class="text-center">
          <a
             ng-show="!(serversListCtl.isNodeInactiveFaied(node) && !serversListCtl.isNodeUnhealthy(node)) && rbac.cluster.nodes.write"
             class="link-heavy"
             ng-class="{dynamic_disabled: serversListCtl.disableRemoveBtn(node)}"
             ng-click="!serversListCtl.disableRemoveBtn(node) && serversListCtl.ejectServer(node)">Remove</a>
          &nbsp;
          <a
             ng-show="!(serversListCtl.isNodeInactiveFaied(node) && !serversListCtl.isNodeUnhealthy(node)) && rbac.cluster.nodes.write"
             class="link-heavy"
             ng-class="{dynamic_disabled: serversListCtl.isFailOverDisabled(node)}"
             ng-click="!serversListCtl.isFailOverDisabled(node) && serversListCtl.failOverNode(node)">Fail Over</a>
          <span
             class="warning"
             ng-show="serversListCtl.isNodeInactiveFaied(node) && !serversListCtl.isNodeUnhealthy(node)">
            Failed Over: Pending Removal
          </span>
        </td>
      </tr>
      <tr
         class="grayblue-5"
         ng-if="serversCtl.isDetailsOpened(node.hostname) && rbac.cluster.nodes.read"
         ui-view="details">
      </tr>
    </tbody>

    <tbody ng-if="!serversCtl.nodes[serversListCtl.stateParamsNodeType].length">
      <tr class="border-top">
        <td colspan="10">There are no servers pending rebalance.</td>
      </tr>
    </tbody>
  </table>
</div>
</div>
