<div>
  <a href="javascript: window.history.back();">&lt back to Views</a>

  <div ng-class="{fiter_opened: viewsEditingCtl.isFilterOpened}">

    <div ng-show="rbac.cluster.bucket[viewsEditingCtl.currentBucketName].data.read">
      <div ng-click="viewsEditingCtl.toggleSampleDocument()">
        <div class="interim row">
          <h4
             class="disclosure"
             ng-class="{disclosed: !viewsEditingCtl.isSampleDocumentClosed}">
            {{viewsEditingCtl.state.sampleDocument.meta.id}}
          </h4>
          <span>
            <button
               ng-disabled="viewsEditingCtl.isPreviewRandomDisabled()"
               ng-click="!viewsEditingCtl.isPreviewRandomDisabled() && viewsEditingCtl.previewRandomDocument($event)">Preview a Random Document</button>
            <button
               ng-disabled="viewsEditingCtl.isEditDocumentDisabled()"
               ng-click="!viewsEditingCtl.isEditDocumentDisabled() && viewsEditingCtl.goToDocumentsSection($event)">Edit Document</button>
          </span>
        </div>
      </div>

      <div
         class="row"
         ng-hide="viewsEditingCtl.isSampleDocumentClosed"
         mn-spinner="viewsEditingCtl.awaitingSampleDocument()">
        <div
           class="flex-grow-one width-8"
           spellcheck="false"
           ng-if="!viewsEditingCtl.state.sampleDocument.warnings"
           ng-model="viewsEditingCtl.state.sampleDocument.jsonJSON"
           ui-codemirror="viewsEditingCtl.sampleDocumentOptions"></div>
        <div
           class="flex-grow-one width-4"
           spellcheck="false"
           ng-if="!viewsEditingCtl.state.sampleDocument.warnings"
           ng-model="viewsEditingCtl.state.sampleDocument.metaJSON"
           ui-codemirror="viewsEditingCtl.sampleMetaOptions"></div>
        <div
           class="flex-grow-one"
           ng-show="viewsEditingCtl.state.sampleDocument.warnings"
           ng-messages="viewsEditingCtl.state.sampleDocument.warnings">
          <span ng-message="documentDoesNotExist">A document with that ID does not exist</span>
          <span ng-message="largeDocument">Large documents are not allowed for preview</span>
          <span ng-message="thereAreNoDocs">There are no documents</span>
        </div>
      </div>
    </div>

    <div
       class="interim row"
       ng-click="viewsEditingCtl.toggleViews()">
      <h4
         class="disclosure"
         ng-class="{disclosed: !viewsEditingCtl.isViewsClosed}">
        {{viewsEditingCtl.isSpatial ? "Spatial" : "View"}} Code
      </h4>
      <span>
        <button
           ng-disabled="viewsEditingCtl.isViewsEditorControllsDisabled()"
           ng-click="!viewsEditingCtl.isViewsEditorControllsDisabled() && viewsEditingCtl.saveAs($event)">Save As...</button>
        <button
           ng-disabled="viewsEditingCtl.isViewsEditorControllsDisabled()"
           ng-click="!viewsEditingCtl.isViewsEditorControllsDisabled() && viewsEditingCtl.save($event)">Save</button>
      </span>
    </div>
    <div
       class="ellipsis error"
       ng-show="viewsEditingCtl.state.viewsError.reason">
      {{viewsEditingCtl.state.viewsError.reason}}
    </div>
    <div
       ng-show="!viewsEditingCtl.isViewsClosed"
       class="row"
       mn-spinner="viewsEditingCtl.awaitingViews()">
      <div
         class="flex-grow-one"
         ng-class="{'width-8': !viewsEditingCtl.isSpatial}">
        <label for="viewcode_map">Map</label>
        <textarea
           ng-if="viewsEditingCtl.isSpatial"
           spellcheck="false"
           ng-model="viewsEditingCtl.state.currentDocument.doc.json.spatial[viewsEditingCtl.viewId]"
           ui-codemirror="viewsEditingCtl.viewsOptions"
           ></textarea>
        <textarea
           ng-if="!viewsEditingCtl.isSpatial"
           spellcheck="false"
           ng-model="viewsEditingCtl.state.currentDocument.doc.json.views[viewsEditingCtl.viewId].map"
           ui-codemirror="viewsEditingCtl.viewsOptions"
           ></textarea>
      </div>
      <div
         ng-if="!viewsEditingCtl.isSpatial"
         class="flex-grow-one">
        <label for="viewcode_reduce">Reduce (built in:
          <a ng-click="viewsEditingCtl.setReduceValue('_count')">_count</a>,
          <a ng-click="viewsEditingCtl.setReduceValue('_sum')">_sum</a>,
          <a ng-click="viewsEditingCtl.setReduceValue('_stats')">_stats</a>)
        </label>
        <textarea
           placeholder="(optional)"
           spellcheck="false"
           ng-change="viewsEditingCtl.onReduceChange(viewsEditingCtl.state.currentDocument.doc.json.views[viewsEditingCtl.viewId])"
           ng-model="viewsEditingCtl.state.currentDocument.doc.json.views[viewsEditingCtl.viewId].reduce"
           ui-codemirror="viewsEditingCtl.viewsOptions"
           ></textarea>
      </div>
    </div>
    <ui-view ng-if="viewsEditingCtl.state && !viewsEditingCtl.state.isEmptyState"></ui-view>
  </div>
</div>
